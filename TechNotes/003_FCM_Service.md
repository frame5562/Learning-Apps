# FCM 개념 정리

### 1. **FCM(Firebase Cloud Messaging)?**
새 이메일, 데이터 동기화 등과 같은 알림 메시지를 전송하여 사용자를 유지하고, 재참여를 유도할 수 있다. 채팅 메시지의 경우 **최대 4,000byte** 의 페이로드를 클라이언트 앱에 전송할 수 있다.

#### **개발 과정**
- **FCM SDK 설정**: 플랫폼에 맞는 안내에 따라 앱에서 Firebase 및 FCM 설정 (== 의존성 추가)
- **클라이언트 앱 개발**: 클라이언트 앱에 메시지 처리, 토픽 구독, 기타 Notification 생성 등의 기능 추가 구성
- **앱 서버 개발**: Firebase 서비스 이용시 직접 개발한 웹 서버에 구성하여 사용할 것인지,  Firebase 에서 제공하는 Console 프로그램을 이용할 것인지 결정 후 구성

### **FCM 메시지의 종류**
FCM 메시지는 총 3가지로 구분 된다.
1. 알림 메시지 : 메시지 형식은 title, body 로 구성되어 앱이 백그라운드 상태에 있을 때, FirebaseSDK에 의해 자동으로 Notification 이 생성된다. 만약 앱이 포그라운드에 있는 상태라면 클라이언트 앱의 서비스에서 추가 작업을 구현해주어야 한다. (ex. 앱이 포그라운드에 있다고 하더라도 Noti를 보여주고 싶은 경우)

2. 데이터 메시지 : 관리자가 정의한 JSON 형식의 데이터 메시지 구성으로, 앱이 백/포그라운드 위치 상관 없이 클라이언트 앱에 정의된 규칙을 따라 Notification 표시 여부를 결정한다.

3. 알림 및 데이터 페이로드가 포함된 메시지 : 알림 메시지와 데이터 메시지가 혼합된 형태이다. 앱이 포그라운드 상태일 때 앱에서 페이로드가 둘다 제공되는 메시지 객체를 수신한다. 앱이 백그라운드 상태에 있을 때에는 알림 페이로드가 앱의 알림 목록에 수신되며 **알람을 탭한 경우**에만 데이터 페이로드를 처리한다.

### **Firebase Token ?**
클라이언트 기기를 고유하게 식별하기 위한 값, FCM 서버가 특정 기기에 메시지를 정확하게 전달하기 위해 필요하다.
- Token 값이 생성/변경 되는 시점 : 앱 설치, 앱 재설치, 앱 데이터(캐시)가 삭제되었을 때, FCM 서버의 판단이 있을 때 Token 재발급

#### 기타
- INTERNET 권한이 필요함
- 알람 권한이 허용 되었는지 확인 필수!
- 테스트 휴대폰이 wifi 연결이 되어있지 않을 경우 Fireabse Token 발급 불가
- Firebase SDK 설정에 문제가 없다면 Token 은 별도의 발급 절차 없이 앱 설치와 동시에 생성
- FirebaseConsole 에 등록된 pakage 값이 정확한지, SHA-1 키 다른 것과 중복되지 않는지, 확인



### 참고 문서
[Firebase 문서 - FCM](https://firebase.google.com/docs/cloud-messaging)

---

<sub>작성일: 2024년 10월 29일</sub>